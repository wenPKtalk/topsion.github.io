---
title: 数据库事务的来龙去脉
date: 2022-06-28 08:34:13
tags: [Transcation,Database]
categories: [Database]
---

### 引言

事务管理是日常开发过程中绕不开的技术，引入事务的目的是为了保证数据持久化过程中的**一致性(Consistency)**。事务的概念最初是源于数据库，但今天的信息系统中，所有需要保证数据正确性（一致性）的场景下，包括但不限于数据库、缓存、事务内存、消息、队列、对象文件存储等等，都有可能会涉及到事务处理。这篇总结主要是总结清楚事务的来龙去脉，无关具体的某个中间件。深度推荐[《周志明的软件架构课》](https://time.geekbang.org/column/article/319481)

### 定义事务的ACID

* 原子性（Atomic）同一业务处理过程中，事务保证了多项对数据的修改，要么全部成功，要么全部失败。
* 隔离性（Isolation）在不同的业务处理过程中，事务保证了各自读写的业务数据相互不可见，不会彼此影响。
* 持久性（Durability）事务保证了当业务处理完成后，事务提交后能够被持久化，不会丢失。
* 一致性（Consistency）一致性。利用A, I, D 保证了业务数据的一致性。

**A,  I, D是手段，C 是目的。** ACID更像是凑单词。

### 本地事务（局部事务）Local Transaction

* 本地事务是指仅操作特定单一事务资源，不需要**全局事务管理器**进行协调的事务。

* 本地事务是最基础的一种事务处理方案，通常只适用于单个服务使用单个数据源的场景，它是直接依赖于数据源（通常是数据库系统）本身的事务能力来工作的。

* 本地事务的开启、终止、提交、回滚、嵌套、设置隔离级别、乃至与应用代码贴近的传播方式，全部都要依赖底层数据库的支持。

* 例如：Spring提供的事务注解，如果数据库引擎不支持那么这个注解也是无意义的。

  ```java
  @Transactional(propagation = Propagation.REQUIRED, //传播方式
                 rollbackFor = Exception.class, //回滚异常
                 isolation = ISOLATION_REPEATABLE_READ //隔离级别
                )
  ```

  
