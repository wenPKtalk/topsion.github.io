---
title: 理解Redis缓存雪崩，缓存击穿，缓存穿透
date: 2020-11-05 10:07:13
tags: redis
---

#### 一. 缓存雪崩
“雪崩来临的时候没有一片雪花是无辜的”。缓存雪崩就是大范围甚至于整个redis提供的缓存服务不可用了，进而导致所有的请求都直接到了数据库，甚至于击垮整个服务链路。造成整个服务不可用。

**出现原因：**

1. 给缓存设置了过期时间，且大范围的缓存数据的过期时间一致。

2. redis服务宕机。

**解决方案：**

提前预案: 
1. 给redis过期时间加随机值预防大面积的缓存同时过期失效。
2. redis集群高可用可用，哨兵机制。

兜底方案: 
3. 服务熔断，服务降级。监控到缓存服务不可用时直接返回，或者限制流量直接请求到数据库层。

#### 二. 缓存击穿
相交于缓存雪崩大范围或整体缓存不可用缓存击穿则是指某个热点key过期，导致的缓存失效。常常是一部分热点数据，如秒杀产品的库存数据。

**出现原因：**
热点数据过期，或者被其他手段删除。

**解决方案：**

1. 对于热点数据缓存时不设置过期时间。

2. 第一个请求发现热点数据不在redis缓存中，可以先阻塞其他请求，等到第一个请求将数据库数据读出来并缓存到redis后再唤醒其他请求从缓存服务中读取热点数据。

﻿

#### 三. 缓存穿透
缓存穿透则是另外一个层面，指的时请求所访问的数据既不在缓存中，也不在数据库中。如果应用持续有大量请求访问数据，就会同时给缓存和数据库带来巨大压力。

**出现原因：**

1. 业务层误操作访问到了不会存在的数据。

2. 恶意请求攻击

**解决方案：**

1. 第一个请求发现热点数据不在redis缓存中和数据库中，可以先阻塞其他请求，缓存一个缺省值返回。

2. 利用redis提供的布隆过滤器。

3. 前端有效值校验。

﻿

#### 四. 总结
**缓存雪崩** ，**缓存击穿**均属于缓存失效的一种异常缓存雪崩影响范围大于缓存击穿。**缓存穿透**则是数据本身就在整个数据存储层。